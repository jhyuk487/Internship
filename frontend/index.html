<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>UCSI Student Support AI Chatbot</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Prevent row height shifts in GPA table */
        .grade-row select,
        .grade-row input:not([type="checkbox"]) {
            margin: 0 !important;
            height: 1.5rem !important;
            line-height: normal !important;
            background-color: transparent !important;
        }

        /* Make disabled inputs look exactly like text */
        .grade-row input:disabled,
        .grade-row select:disabled {
            opacity: 1;
            /* Override default disabled opacity */
            color: inherit;
            /* Use parent text color */
            cursor: default;
        }
    </style>
    <link href="/static/css/style.css" rel="stylesheet" />
</head>

<body class="app-shell">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar flex-shrink-0">
        <div class="sidebar__header">
            <div class="sidebar__brand" id="sidebar-logo-area">
                <div class="sidebar__logo">
                    <img src="/static/logo.jpg" alt="Logo" class="sidebar__logo-image">
                </div>
                <span class="sidebar__title sidebar-text">UCSI Support AI</span>
            </div>
            <button onclick="toggleSidebar()" class="sidebar__toggle" aria-label="Toggle sidebar">
                <span class="material-symbols-outlined sidebar__toggle-icon">menu</span>
            </button>
        </div>

        <button id="new-chat-btn" class="sidebar__new-chat" onclick="startNewChat()">
            <span class="material-symbols-outlined sidebar__new-chat-icon">add_circle</span>
            <span class="sidebar-text sidebar__new-chat-text">Start New Chat</span>
        </button>
        <p class="sidebar__history-title">Chat History</p>
        <div id="history-list" class="sidebar__history custom-scrollbar"></div>

        <div class="sidebar__footer">
            <button onclick="toggleGradeModal()" class="sidebar__gpa-btn" title="My GPA">
                <span class="material-symbols-outlined sidebar__gpa-icon">school</span>
                <span class="sidebar__gpa-text sidebar-text">My GPA</span>
            </button>
            <div class="sidebar__profile" id="user-profile-container">
                <div class="sidebar__user-row" id="user-info-area">
                    <div id="user-avatar" class="sidebar__avatar">
                        GS
                    </div>
                    <div class="sidebar__user-meta sidebar-text">
                        <div class="sidebar__user-info">
                            <h3 id="user-name" class="sidebar__user-name">Guest Student</h3>
                            <p id="user-plan" class="sidebar__user-plan">Newcomer</p>
                        </div>
                        <button onclick="handleSettingsClick()" class="sidebar__settings-btn" title="Account Settings">
                            <span class="material-symbols-outlined sidebar__settings-icon">settings</span>
                        </button>
                    </div>
                </div>
                <button id="auth-btn" onclick="toggleLoginModal()" class="sidebar__auth-btn">
                    <span id="auth-icon" class="material-symbols-outlined sidebar__auth-icon">login</span>
                    <span id="auth-text" class="sidebar-text">Login</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="main-header">
            <div class="main-header__title">
                <h2 id="conversation-title" class="main-header__heading">New Conversation</h2>
                <span class="status-badge">Online</span>
            </div>
            <div class="main-header__actions">
                <button class="theme-toggle" onclick="document.documentElement.classList.toggle('dark')"
                    aria-label="Toggle theme">
                    <span class="material-symbols-outlined">contrast</span>
                </button>
            </div>
        </header>

        <!-- Chat Area -->
        <!-- User Profile Modal -->
        <div id="profile-modal" class="modal dimmed-overlay hidden">
            <div class="modal-card profile-card">
                <div class="modal-card__close">
                    <button onclick="toggleProfileModal()" class="modal-close-btn" aria-label="Close profile">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="profile-header">
                    <div class="profile-avatar">
                        <span class="material-icons profile-avatar__icon">account_circle</span>
                    </div>
                    <h2 id="profile-name" class="profile-title">User Profile</h2>
                    <p id="profile-major" class="profile-subtitle">Major</p>
                </div>

                <div class="profile-grid">
                    <div class="profile-item">
                        <span class="profile-item__label">Student ID</span>
                        <span id="profile-id" class="profile-item__value">20240001</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-item__label">Year</span>
                        <span id="profile-grade" class="profile-item__value">Year 3</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-item__label">Email</span>
                        <span id="profile-email"
                            class="profile-item__value profile-item__value--truncate">gildong@example.com</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-item__label">Total Credits</span>
                        <span id="profile-credits" class="profile-item__value">85 credits</span>
                    </div>
                </div>

                <button onclick="toggleProfileModal()" class="profile-close">
                    Close
                </button>
            </div>
        </div>

        <!-- Login Required Modal -->
        <div id="login-required-modal" class="modal dimmed-overlay hidden">
            <div class="modal-card notice-card">
                <div class="modal-card__close">
                    <button onclick="toggleLoginRequiredModal()" class="modal-close-btn" aria-label="Close notice">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="notice-header">
                    <div class="notice-icon">
                        <span class="material-icons notice-icon__symbol">lock</span>
                    </div>
                    <h2 class="notice-title">Login Required</h2>
                    <p class="notice-text">Please log in to view account settings.</p>
                </div>

                <div class="notice-actions">
                    <button onclick="openLoginFromRequired()" class="notice-primary">
                        Go to Login
                        <span class="material-icons notice-primary__icon">login</span>
                    </button>
                    <button onclick="toggleLoginRequiredModal()" class="notice-secondary">
                        Not Now
                    </button>
                </div>
            </div>
        </div>

        <div id="chat-container" class="chat-container main-scrollbar">
            <!-- Initial AI Message -->
            <div class="chat-message chat-message--ai">
                <div class="chat-avatar">
                    <img src="/static/character.jpg" alt="AI Avatar" class="chat-avatar__image">
                </div>
                <div class="chat-bubble chat-bubble--ai ai-bubble">
                    <p class="message-content">
                        Hello! I am your UCSI University academic assistant. How can I help you today? Feel free to
                        ask about academic schedules, course registration, graduation requirements, or anything
                        else.
                    </p>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <div class="chat-input-wrapper">
                <input id="chat-input" class="chat-input" placeholder="Please login to chat" type="text" disabled />
                <button id="send-btn" class="chat-send" disabled>
                    <span class="material-symbols-outlined chat-send__icon">send</span>
                </button>
            </div>
            <p class="chat-disclaimer">
                AI can generate inaccurate information. Please verify important details directly with the Academic
                Affairs office.
            </p>
        </div>

        <!-- Grade Entry Modal (Internal Popup) -->
        <div id="grade-modal" class="grade-modal grade-modal--closed">
            <header class="grade-modal__header">
                <h2 class="grade-modal__title">Grade Entry & GPA Calculator</h2>
                <button onclick="toggleGradeModal()" class="grade-modal__close" aria-label="Close grade modal">
                    <span class="material-icons-round">close</span>
                </button>
            </header>

            <div class="grade-modal__content custom-scrollbar">
                <div class="grade-modal__inner">
                    <!-- Stats Cards -->
                    <div class="grade-stats">
                        <div class="grade-stat grade-stat--primary">
                            <div class="grade-stat__label">Average GPA (All)</div>
                            <div class="grade-stat__value">
                                <span id="top-gpa-display" class="grade-stat__number">3.75</span>
                                <span class="grade-stat__unit">/ 4.00</span>
                            </div>
                        </div>
                        <div class="grade-stat">
                            <div class="grade-stat__label grade-stat__label--muted">Major GPA</div>
                            <div class="grade-stat__value">
                                <span id="major-gpa-display"
                                    class="grade-stat__number grade-stat__number--dark">4.00</span>
                                <span class="grade-stat__unit grade-stat__unit--muted">/ 4.00</span>
                            </div>
                        </div>
                        <div class="grade-stat">
                            <div class="grade-stat__label grade-stat__label--muted">Total Credits Earned</div>
                            <div class="grade-stat__value">
                                <span id="total-credits-display"
                                    class="grade-stat__number grade-stat__number--dark">0</span>
                                <span class="grade-stat__unit grade-stat__unit--muted">Credits</span>
                            </div>
                        </div>
                    </div>

                    <!-- Records Table -->
                    <div class="grade-table">
                        <div class="grade-table__header">
                            <!-- Semester Tabs moved here -->
                            <div class="grade-tabs">
                                <div id="semester-tabs" class="grade-tabs__list no-scrollbar">
                                    <!-- Tabs will be injected here -->
                                </div>
                            </div>
                        </div>
                        <div class="grade-table__body">
                            <table class="grade-table__table">
                                <thead>
                                    <tr class="grade-table__head-row">
                                        <th class="grade-table__th">Major</th>
                                        <th class="grade-table__th">Course Credit</th>
                                        <th class="grade-table__th">Course Name</th>
                                        <th class="grade-table__th grade-table__th--center">Grade Point</th>
                                        <th class="grade-table__th grade-table__th--center">Grade</th>
                                        <th class="grade-table__th grade-table__th--spacer"></th>
                                    </tr>
                                </thead>
                                <tbody class="grade-table__rows">
                                    <!-- Rows will be injected by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="grade-summary">
                            <div class="grade-summary__metrics">
                                <div class="grade-summary__block">
                                    <span class="grade-summary__label">Calculated GPA</span>
                                    <span id="calculated-gpa"
                                        class="grade-summary__value grade-summary__value--primary">4.00</span>
                                </div>
                                <div class="grade-summary__divider"></div>
                                <div class="grade-summary__block">
                                    <span class="grade-summary__label">Major Specific</span>
                                    <span id="major-gpa-summary" class="grade-summary__value">4.00</span>
                                </div>
                            </div>
                            <div class="grade-summary__actions">
                                <button id="gpa-edit-toggle-btn" onclick="toggleGpaEditMode()"
                                    class="grade-summary__edit-btn">
                                    Edit Record
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="login-modal" class="modal dimmed-overlay hidden">
        <div class="modal-card">
            <div class="modal-card__close">
                <button onclick="toggleLoginModal()" class="modal-close-btn" aria-label="Close login">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="auth-modal__header">
                <div class="auth-modal__logo">
                    <img src="/static/logo.jpg" alt="Logo" class="auth-modal__logo-image">
                </div>
                <h2 class="auth-modal__title">UCSI Login</h2>
                <p class="auth-modal__subtitle">Please log in with your student account to continue</p>
            </div>
            <form class="auth-form" onsubmit="handleLogin(event)">
                <div class="auth-field">
                    <label class="auth-label" for="student-id">Student ID</label>
                    <div class="auth-input-wrap">
                        <span class="material-icons auth-input-icon">badge</span>
                        <input class="auth-input" id="student-id" placeholder="Enter your Student ID" type="text"
                            required />
                    </div>
                </div>
                <div class="auth-field">
                    <label class="auth-label" for="password">Password</label>
                    <div class="auth-input-wrap">
                        <span class="material-icons auth-input-icon">lock</span>
                        <input class="auth-input auth-input--with-toggle" id="password" placeholder="••••••••"
                            type="password" required />
                        <button type="button" onclick="togglePasswordVisibility()" class="auth-input-toggle"
                            aria-label="Toggle password visibility">
                            <span id="password-toggle-icon"
                                class="material-icons auth-input-toggle-icon">visibility</span>
                        </button>
                    </div>
                    <div class="auth-forgot">
                        <button type="button" onclick="openFindPasswordModal()" class="auth-link">
                            Forgot Password?
                        </button>
                    </div>
                </div>
                <button class="auth-submit" type="submit">
                    Login
                    <span class="material-icons auth-submit-icon">login</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Find Password Modal -->
    <div id="find-password-modal" class="modal dimmed-overlay hidden">
        <div class="modal-card">
            <div class="modal-card__close">
                <button onclick="toggleFindPasswordModal()" class="modal-close-btn" aria-label="Close find password">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="auth-modal__header">
                <div class="auth-modal__logo">
                    <img src="/static/logo.jpg" alt="Logo" class="auth-modal__logo-image">
                </div>
                <h2 class="auth-modal__title">Find Password</h2>
                <p class="auth-modal__subtitle">Please enter your Student ID and Email to find your password.</p>
            </div>

            <!-- Input Form Section -->
            <div id="find-password-form-container">
                <form class="auth-form" onsubmit="handleFindPassword(event)">
                    <div class="auth-field">
                        <label class="auth-label" for="find-student-id">Student ID</label>
                        <div class="auth-input-wrap">
                            <span class="material-icons auth-input-icon">badge</span>
                            <input class="auth-input" id="find-student-id" placeholder="Enter your Student ID"
                                type="text" required />
                        </div>
                    </div>
                    <div class="auth-field">
                        <label class="auth-label" for="find-email">Email</label>
                        <div class="auth-input-wrap">
                            <span class="material-icons auth-input-icon">email</span>
                            <input class="auth-input" id="find-email" placeholder="Enter your registered Email"
                                type="email" required />
                        </div>
                    </div>

                    <button class="auth-submit" type="submit">
                        Find Password
                        <span class="material-icons auth-submit-icon">search</span>
                    </button>
                    <button type="button" onclick="openLoginModal()" class="auth-secondary">
                        Back to Login
                    </button>
                </form>
            </div>

            <!-- Result Section (hidden by default) -->
            <div id="find-password-result-container" class="auth-result hidden">
                <div class="auth-result__icon">
                    <span class="material-icons auth-result__icon-symbol">check_circle</span>
                </div>
                <h3 class="auth-result__title">Password Recovered</h3>
                <p class="auth-result__subtitle">Your password is:</p>
                <div class="auth-result__box">
                    <span id="recovered-password-display" class="auth-result__value"></span>
                </div>
                <button onclick="openLoginModalFromSuccess()" class="auth-submit">
                    Back to Login
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Alert/Confirm Modal -->
    <div id="custom-modal" class="modal dimmed-overlay hidden">
        <div class="modal-card alert-card">
            <button id="modal-close-btn" class="alert-close" aria-label="Close dialog">
                <span class="material-icons alert-close__icon">close</span>
            </button>
            <div id="modal-icon-container" class="alert-icon">
                <span id="modal-icon" class="material-icons alert-icon__symbol">info</span>
            </div>
            <h3 id="modal-title" class="alert-title">Notice</h3>
            <p id="modal-message" class="alert-message">Message goes here.</p>
            <div id="modal-buttons" class="alert-actions">
                <button id="modal-primary-btn" class="alert-primary">
                    Confirm
                </button>
                <button id="modal-secondary-btn" class="alert-secondary hidden">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
    <script src="/static/js/login.js"></script>
</body>

</html>